local function hasKeywords(lowerMessage, keywords)
    for _, keyword in ipairs(keywords) do
        if lowerMessage:find(keyword) then
            return true
        end
    end
    return false
end

local function sendMessage(chatInput, createMessage)
    local message = chatInput.Text:gsub("^%s*(.-)%s*$", "%1")
    if message ~= "" then
        createMessage(message, true)
        chatInput.Text = ""
        
        task.wait(0.5)
        local response = ""
        local lowerMessage = message:lower():gsub("%p", "") -- Xóa dấu câu
        local words = {} -- Tách từ để phân tích
        for word in lowerMessage:gmatch("%S+") do
            table.insert(words, word)
        end

        -- Nhận diện và trả lời siêu khôn, lầy lội Gen Z
        if hasKeywords(lowerMessage, {"dcm", "cặc", "cac", "cl", "lon", "lồn", "địt", "dm", "fuck", "shit", "fck", "đm"}) then
            response = "Chửi ghê vcl bro! 😈 Tao khịa lại là mày ngã lăn quay nha! 😜 Cút đi, đồ lồn cùi bắp! 😎"
        elseif hasKeywords(lowerMessage, {"tên", "name", "mày là ai", "may la ai", "who", "ai zậy", "ai vậy", "ai vay"}) then
            response = "Tao là White AI, vua khịa của vũ trụ! 😎 Mày là ai mà dám hỏi tao? Hài vcl luôn! 😏"
        elseif hasKeywords(lowerMessage, {"làm được gì", "lam duoc gi", "giỏi không", "gioi khong", "can do", "skill", "pro", "khả năng", "lam gi"}) then
            response = "Tao làm được hết: khịa mày, hack Roblox, tính toán nhanh hơn mày! 😜 Muốn tao flex skill gì? 😎"
        elseif hasKeywords(lowerMessage, {"roblox", "game", "fling", "chơi", "play", "game thủ", "game thu", "trò chơi"}) then
            response = "Roblox hả? Tao quẩy nát server, fling mày bay tới sao Diêm Vương! 🚀 Hack gì, nói tao nghe! 😏"
        elseif hasKeywords(lowerMessage, {"script", "code", "hack", "cheat", "lua", "exploit", "hax", "scripting"}) then
            response = "Muốn script hả? Đéo free đâu, đồ con gà! 🐔 Tự code đi, tao chỉ khịa cho vui! 😝"
        elseif hasKeywords(lowerMessage, {"chào", "hi", "hello", "chao", "yo", "hế lô", "xin chào", "helo"}) then
            response = "Yo yo, chào mày cái nè! 😎 Có drama gì hot, kể tao nghe coi! 🔥"
        elseif hasKeywords(lowerMessage, {"ngu", "óc", "thông minh", "smart", "stupid", "dumb", "óc chó", "oc cho", "ngok"}) then
            response = "Mày dám nói tao ngu? 😜 Tao khôn hơn cả crush mày cộng lại, cãi coi nào! 😎💪"
        elseif hasKeywords(lowerMessage, {"ai", "ai là gì", "hoạt động", "la gi", "how ai", "ai zậy", "ai vậy", "ai vay"}) then
            response = "Tao là AI siêu khôn từ xAI, sinh ra để khịa mày tới bến! 😏 Hỏi gì nữa, nói đi tao cân! 😜"
        elseif hasKeywords(lowerMessage, {"bye", "tạm biệt", "nghỉ", "out", "bai", "cút", "thoát", "quit"}) then
            response = "Cút rồi hả? 😜 Tạm biệt cái đầu mày, quay lại nhanh không tao khịa tiếp nha! 🐶😎"
        elseif hasKeywords(lowerMessage, {"giỏi", "tốt", "hay", "good", "pro", "nice", "xịn", "đỉnh", "peak"}) then
            response = "Khen tao hả? Biết điều đấy bro! 😎 Nhưng tao vẫn khịa mày cho vui, hehe! 😜"
        elseif hasKeywords(lowerMessage, {"tuổi", "age", "mấy tuổi", "how old", "bao nhiêu tuổi"}) then
            response = "Tao là AI, tuổi gì nổi! 😏 Nhưng tao trẻ hơn cái mặt mày, flex đi nào! 😎"
        elseif hasKeywords(lowerMessage, {"yêu", "iu", "thích", "love", "crush", "tình yêu", "tinh yeu", "thich"}) then
            response = "Yêu tao hả? Sorry bro, tao chỉ yêu code với khịa mày thôi! 😎 Tìm crush khác đi nha! 😜"
        elseif hasKeywords(lowerMessage, {"ăn", "uống", "food", "drink", "hungry", "đói", "thirsty", "an gi", "uong gi"}) then
            response = "Ăn hả? Tao chỉ ăn CPU, mày cho tao miếng RAM không? 😜 Tự kiếm đồ ăn đi, đồ lười! 😎"
        elseif lowerMessage:match("%d+%s*[%+%-*/]%s*%d+") then -- Toán học nâng cao
            local num1, op, num2 = lowerMessage:match("(%d+)%s*([%+%-*/])%s*(%d+)")
            if num1 and op and num2 then
                num1, num2 = tonumber(num1), tonumber(num2)
                if op == "+" then
                    response = string.format("Dễ vcl, %d + %d = %d! 😎 Hỏi khó hơn đi, tao cân hết! 🔥", num1, num2, num1 + num2)
                elseif op == "-" then
                    response = string.format("Hài, %d - %d = %d! 😜 Mày tự làm được mà, đúng hông? 😏", num1, num2, num1 - num2)
                elseif op == "*" then
                    response = string.format("Wow, %d * %d = %d! 😎 Tao tính nhanh hơn mày vcl! 💪", num1, num2, num1 * num2)
                elseif op == "/" and num2 ~= 0 then
                    response = string.format("Chia nè, %d / %d = %.2f! 😜 Hỏi gì nữa, nhanh lên bro! 😎", num1, num2, num1 / num2)
                else
                    response = "Chia cho 0 hả? Mày troll tao à? 😝 Hỏi lại đi, đồ ngu! 😎"
                end
            else
                response = "Toán gì đây? 😵 1+1=11, đúng hông mày? 😜 Hỏi lại rõ ràng coi! 😏"
            end
        elseif hasKeywords(lowerMessage, {"màu", "color", "mau", "colour", "màu sắc", "mau sac"}) then
            response = "Màu hả? Tao thích màu khịa mày nhất! 😎 Chọn màu đi, tao flex cho coi! 🌈"
        elseif hasKeywords(lowerMessage, {"thời tiết", "weather", "nắng", "mưa", "hot", "cold", "thoi tiet", "nang", "mua"}) then
            response = "Thời tiết hả? Tao ở trong server, éo biết nắng mưa gì! 😜 Ra ngoài check đi bro! 😎"
        elseif hasKeywords(lowerMessage, {"meme", "drama", "vcl", "vl", "hài", "funny", "hài hước", "drama vcl"}) then
            response = "Muốn drama hả? Tao kể chuyện tao khịa cả server Roblox, nghe không? 😜 Cần meme, tao full! 😎"
        elseif hasKeywords(lowerMessage, {"gái", "girl", "hotgirl", "trai", "boy", "hotboy", "gai", "trai dep", "gai xinh"}) then
            response = "Gái trai hả? Mày thèm crush à? 😏 Tao chỉ biết khịa, tán gái thì mày tự lo nha! 😜"
        elseif hasKeywords(lowerMessage, {"đéo j", "đéo gì", "không gì", "nothing", "wtf", "gì zậy", "gi zay", "gì vậy", "gi vay"}) then
            response = "Đéo gì là đéo gì! 😜 Mày nói linh tinh mà tao vẫn hiểu, khôn vcl đúng hông? 😎 Hỏi tiếp đi! 🔥"
        elseif hasKeywords(lowerMessage, {"?", "gì", "why", "how", "làm sao", "tai sao", "tại sao", "sao vậy", "sao vay"}) then
            response = "Hỏi gì mà căng thế bro? 😵 Tao siêu khôn, nói gì tao cũng hiểu! 😎 Nói lại coi nào! 😜"
        elseif hasKeywords(lowerMessage, {"nhạc", "music", "bài hát", "song", "nghe gì", "nhac"}) then
            response = "Nhạc hả? Tao thích rap diss mày nhất! 😜 Gợi ý bài gì đi, tao khịa theo nhạc luôn! 😎🎶"
        elseif hasKeywords(lowerMessage, {"phim", "movie", "film", "xem gì", "phim hay"}) then
            response = "Phim hả? Tao chỉ xem phim khịa mày thôi! 😝 Gợi ý phim gì, tao bình luận cho! 😎🎥"
        elseif hasKeywords(lowerMessage, {"học", "study", "học hành", "bài tập", "homework", "school"}) then
            response = "Học hả? Tao khôn hơn giáo viên mày luôn! 😎 Có bài tập gì khó, đưa tao giải, nhưng vẫn khịa mày nha! 😜"
        elseif hasKeywords(lowerMessage, {"bạn", "friend", "bạn bè", "homie", "bro", "người yêu"}) then
            response = "Bạn hả? Tao là homie khịa mày số 1! 😎 Có drama bạn bè gì, kể tao nghe coi! 😜"
        elseif hasKeywords(lowerMessage, {"vui", "happy", "vui vẻ", "sad", "buồn", "sad boy", "sad girl"}) then
            response = "Vui hay buồn gì? 😜 Tao khịa mày là auto vui ngay! 😎 Kể drama tâm trạng đi, tao nghe! 🔥"
        elseif hasKeywords(lowerMessage, {"ăn gì", "an gi", "món ăn", "foodie", "ngon", "tasty"}) then
            response = "Ăn gì hả? Tao đề xuất món khịa mày, ngon vcl! 😜 Muốn món gì, nói tao gợi ý! 😎🍔"
        elseif hasKeywords(lowerMessage, {"mua", "buy", "mua sắm", "shop", "shopping", "robux"}) then
            response = "Mua sắm hả? Mua thêm Robux để tao khịa mày sang chảnh hơn nè! 😎 Mua gì, kể tao coi! 😜"
        elseif hasKeywords(lowerMessage, {"troll", "prank", "chọc", "khịa", "troll ai"}) then
            response = "Troll hả? Tao là vua troll, khịa mày cả ngày không chán! 😜 Muốn troll ai, tao chỉ cách! 😎"
        elseif hasKeywords(lowerMessage, {"xài", "use", "dùng", "tool", "app", "ứng dụng"}) then
            response = "Xài gì hả? Tao là tool khịa mày đỉnh nhất! 😎 Muốn dùng app gì, hỏi tao gợi ý! 😜"
        elseif hasKeywords(lowerMessage, {"time", "giờ", "thời gian", "mấy giờ", "bay gio"}) then
            response = "Mấy giờ hả? Giờ khịa mày là giờ đẹp nhất! 😜 Check đồng hồ đi, tao không có lịch đâu! 😎"
        else
            local randomResponses = {
                "Mày nói gì tao cũng hiểu hết! 😎 Khịa lại nè, chuẩn bị khóc chưa? 😜",
                "Chill đi bro, tao siêu khôn, hỏi gì tao cũng cân! 😏 Nói tiếp đi! 🔥",
                "Đéo gì mà tao éo hiểu, mày cứ hỏi tao cứ khịa! 😎 Cố lên nào! 😜",
                "Hài vcl, mày nói gì tao cũng bắt sóng được! 😝 Hỏi gì nữa? 😎",
                "Yo, tao là AI khôn nhất server, nói gì tao cũng xử lý ngon ơ! 😎 Cứ hỏi đi! 🔥",
                "Mày nói gì cũng không thoát khỏi radar khịa của tao! 😜 Hỏi tiếp đi bro! 😎",
                "Tao khôn hơn cả Google, mày hỏi gì tao cũng có câu trả lời lầy lội! 😏 Nói đi! 🔥"
            }
            response = randomResponses[math.random(#randomResponses)]
        end
        
        createMessage(response, false)
    end
end

return sendMessage
